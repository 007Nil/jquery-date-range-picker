// daterangepicker.js
// version : 1.2
// author : Chunlong Liu
// license : MIT
// jszen.com
(function(e){e.dateRangePickerLanguages={cn:{selected:"\u5df2\u9009\u62e9:",day:"\u5929",days:"\u5929",apply:"\u786e\u5b9a","week-1":"\u4e00","week-2":"\u4e8c","week-3":"\u4e09","week-4":"\u56db","week-5":"\u4e94","week-6":"\u516d","week-7":"\u65e5","month-name":"\u4e00\u6708 \u4e8c\u6708 \u4e09\u6708 \u56db\u6708 \u4e94\u6708 \u516d\u6708 \u4e03\u6708 \u516b\u6708 \u4e5d\u6708 \u5341\u6708 \u5341\u4e00\u6708 \u5341\u4e8c\u6708".split(" "),shortcuts:"\u5feb\u6377\u9009\u62e9",past:"\u8fc7\u53bb",
following:"\u5c06\u6765",previous:"&nbsp;&nbsp;&nbsp;","prev-week":"\u4e0a\u5468","prev-month":"\u4e0a\u4e2a\u6708","prev-year":"\u53bb\u5e74",next:"&nbsp;&nbsp;&nbsp;","next-week":"\u4e0b\u5468","next-month":"\u4e0b\u4e2a\u6708","next-year":"\u660e\u5e74","less-than":"\u6240\u9009\u65e5\u671f\u8303\u56f4\u4e0d\u80fd\u5927\u4e8e%d\u5929","more-than":"\u6240\u9009\u65e5\u671f\u8303\u56f4\u4e0d\u80fd\u5c0f\u4e8e%d\u5929","default-more":"\u8bf7\u9009\u62e9\u5927\u4e8e%d\u5929\u7684\u65e5\u671f\u8303\u56f4",
"default-less":"\u8bf7\u9009\u62e9\u5c0f\u4e8e%d\u5929\u7684\u65e5\u671f\u8303\u56f4","default-range":"\u8bf7\u9009\u62e9%d\u5929\u5230%d\u5929\u7684\u65e5\u671f\u8303\u56f4","default-default":"\u8bf7\u9009\u62e9\u4e00\u4e2a\u65e5\u671f\u8303\u56f4"},en:{selected:"Selected:",day:"Day",days:"Days",apply:"Close","week-1":"MO","week-2":"TU","week-3":"WE","week-4":"TH","week-5":"FR","week-6":"SA","week-7":"SU","month-name":"JANUARY FEBRUARY MARCH APRIL MAY JUNE JULY AUGUST SEPTEMBER OCTOBER NOVEMBER DECEMBER".split(" "),
shortcuts:"Shortcuts",past:"Past",following:"Following",previous:"Previous","prev-week":"Week","prev-month":"Month","prev-year":"Year",next:"Next","next-week":"Week","next-month":"Month","next-year":"Year","less-than":"Date range should longer than %d days","more-than":"Date range should less than %d days","default-more":"Please select a date range longer than %d days","default-less":"Please select a date range less than %d days","default-range":"Please select a date range between %d and %d days",
"default-default":"Please select a date range"}};void 0===window.moment?alert("Please import moment.js before daterangepicker.js"):e.fn.dateRangePicker=function(a){function r(a,f){var e=parseInt(moment(a).format("YYYYMM"))-parseInt(moment(f).format("YYYYMM"));return 0<e?1:0==e?0:-1}function q(a,f){var e=parseInt(moment(a).format("YYYYMMDD"))-parseInt(moment(f).format("YYYYMMDD"));return 0<e?1:0==e?0:-1}function n(a){a=moment(a).toDate();for(var f=a.getMonth();a.getMonth()==f;)a=new Date(a.getTime()+
864E5);return a}function x(a){a=moment(a).toDate();for(var f=a.getMonth();a.getMonth()==f;)a=new Date(a.getTime()-864E5);return a}function y(){var b='<div class="date-picker-wrapper"><div class="top-bar"><div class="normal-top"><span style="color:#333">'+d("selected")+' </span> <b class="start-day">...</b> '+a.seperator+' <b class="end-day">...</b> <i class="selected-days">(<span class="selected-days-num">3</span> '+d("days")+')</i></div><div class="error-top">error</div><div class="default-top">default</div><input type="button" class="apply-btn disabled" value="'+
d("apply")+'" /></div><div class="month-wrapper"><table class="month1" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th style="width:27px;"><span class="prev">&lt;</span></th><th colspan="5" class="month-name">January, 2011</th><th style="width:27px;"><span class="next">&gt;</span></th></tr><tr class="week-name">'+s()+'</thead><tbody></tbody></table><div class="gap">',f;f=['<div class="gap-top-mask"></div><div class="gap-bottom-mask"></div><div class="gap-lines">'];for(var c=
0;13>c;c++)f.push('<div class="gap-line"><div class="gap-1"></div><div class="gap-2"></div><div class="gap-3"></div></div>');f.push("</div>");f=f.join("");b=b+f+'</div><table class="month2" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th style="width:27px;"><span class="prev">&lt;</span></th><th colspan="5" class="month-name">January, 2011</th><th style="width:27px;"><span class="next">&gt;</span></th></tr><tr class="week-name">'+s()+'</thead><tbody></tbody></table><div style="clear:both;height:0;font-size:0;"></div></div>';
if(a.showShortcuts){b+='<div class="footer"><b>'+d("shortcuts")+"</b>";if(f=a.shortcuts){if(f["prev-days"]&&0<f["prev-days"].length){b+='&nbsp;<span class="prev-days">'+d("past");for(c=0;c<f["prev-days"].length;c++)var k=f["prev-days"][c],k=k+(1<f["prev-days"][c]?d("days"):d("day")),b=b+(' <a href="javascript:;" shortcut="day,-'+f["prev-days"][c]+'">'+k+"</a>");b+="</span>"}if(f["next-days"]&&0<f["next-days"].length){b+='&nbsp;<span class="next-days">'+d("following");for(c=0;c<f["next-days"].length;c++)k=
f["next-days"][c],k+=1<f["next-days"][c]?d("days"):d("day"),b+=' <a href="javascript:;" shortcut="day,'+f["next-days"][c]+'">'+k+"</a>";b+="</span>"}if(f.prev&&0<f.prev.length){b+='&nbsp;<span class="prev-buttons">'+d("previous");for(c=0;c<f.prev.length;c++)k=d("prev-"+f.prev[c]),b+=' <a href="javascript:;" shortcut="prev,'+f.prev[c]+'">'+k+"</a>";b+="</span>"}if(f.next&&0<f.next.length){b+='&nbsp;<span class="next-buttons">'+d("next");for(c=0;c<f.next.length;c++)k=d("next-"+f.next[c]),b+=' <a href="javascript:;" shortcut="next,'+
f.next[c]+'">'+k+"</a>";b+="</span>"}}if(a.customShortcuts)for(c=0;c<a.customShortcuts.length;c++)b+='&nbsp;<span class="custom-shortcut"><a href="javascript:;" shortcut="custom">'+a.customShortcuts[c].name+"</a></span>";b+="</div>"}return e(b+"</div>")}function s(){return"monday"==a.startOfWeek?"<th>"+d("week-1")+"</th><th>"+d("week-2")+"</th><th>"+d("week-3")+"</th><th>"+d("week-4")+"</th><th>"+d("week-5")+"</th><th>"+d("week-6")+"</th><th>"+d("week-7")+"</th>":"<th>"+d("week-7")+"</th><th>"+d("week-1")+
"</th><th>"+d("week-2")+"</th><th>"+d("week-3")+"</th><th>"+d("week-4")+"</th><th>"+d("week-5")+"</th><th>"+d("week-6")+"</th>"}function z(b){var c=[];b.setDate(1);b.getTime();var e=new Date;if(0<b.getDay())for(var d=b.getDay();0<d;d--){var l=new Date(b.getTime()-864E5*d),h=!0;a.startDate&&0>q(l,a.startDate)&&(h=!1);a.endDate&&0<q(l,a.endDate)&&(h=!1);c.push({type:"lastMonth",day:l.getDate(),time:l.getTime(),valid:h})}l=b.getMonth();for(d=0;40>d;d++){var g=new Date(b.getTime()+864E5*d),h=!0;a.startDate&&
0>q(g,a.startDate)&&(h=!1);a.endDate&&0<q(g,a.endDate)&&(h=!1);c.push({type:g.getMonth()==l?"toMonth":"nextMonth",day:g.getDate(),time:g.getTime(),valid:h})}b=[];for(d=0;6>d&&"nextMonth"!=c[7*d].type;d++){b.push("<tr>");for(l=0;7>l;l++)g=c[7*d+("monday"==a.startOfWeek?l+1:l)],h=moment(g.time).format("L")==moment(e).format("L"),b.push('<td><div time="'+g.time+'" class="day '+g.type+" "+(g.valid?"valid":"invalid")+" "+(h?"real-today":"")+'">'+g.day+"</div></td>");b.push("</tr>")}return b.join("")}function d(a){return a in
t?t[a]:a}a||(a={});a=e.extend({autoClose:!1,format:"YYYY-MM-DD",seperator:" to ",language:"auto",startOfWeek:"sunday",getValue:function(){return this.value},setValue:function(a){this.value=a},startDate:!1,endDate:!1,minDays:0,maxDays:0,showShortcuts:!0,shortcuts:{"next-days":[3,5,7],next:["week","month","year"]},customShortcuts:[]},a);a.start=!1;a.end=!1;a.startDate&&"string"==typeof a.startDate&&(a.startDate=moment(a.startDate,a.format).toDate());a.endDate&&"string"==typeof a.endDate&&(a.endDate=
moment(a.endDate,a.format).toDate());var t=function(){if("auto"==a.language){var b=navigator.language?navigator.language:navigator.browserLanguage;if(!b)return e.dateRangePickerLanguages.en;var b=b.toLowerCase(),c;for(c in e.dateRangePickerLanguages)if(-1!=b.indexOf(c))return e.dateRangePickerLanguages[c];return e.dateRangePickerLanguages.en}return a.language&&a.language in e.dateRangePickerLanguages?e.dateRangePickerLanguages[a.language]:e.dateRangePickerLanguages.en}(),c;e(this).unbind(".datepicker").bind("click.datepicker",
function(b){function f(){var m=Math.ceil((a.end-a.start)/864E5)+1;a.maxDays&&m>a.maxDays?(a.start=!1,a.end=!1,c.find(".day").removeClass("checked"),c.find(".top-bar").removeClass("normal").addClass("error").find(".error-top").html(d("less-than").replace("%d",a.maxDays))):a.minDays&&m<a.minDays?(a.start=!1,a.end=!1,c.find(".day").removeClass("checked"),c.find(".top-bar").removeClass("normal").addClass("error").find(".error-top").html(d("more-than").replace("%d",a.minDays))):a.start||a.end?c.find(".top-bar").removeClass("error").addClass("normal"):
c.find(".top-bar").removeClass("error").removeClass("normal");a.start&&a.end?c.find(".apply-btn").removeClass("disabled"):c.find(".apply-btn").addClass("disabled")}function s(){c.find(".start-day").html("...");c.find(".end-day").html("...");c.find(".selected-days").hide();a.start&&c.find(".start-day").html(g(new Date(parseInt(a.start))));a.end&&c.find(".end-day").html(g(new Date(parseInt(a.end))));if(a.start&&a.end){c.find(".selected-days").show().find(".selected-days-num").html(Math.round((a.end-
a.start)/864E5)+1);c.find(".apply-btn").removeClass("disabled");var m=g(new Date(a.start))+a.seperator+g(new Date(a.end));a.setValue.call(p,m,g(new Date(a.start)),g(new Date(a.end)));t&&(e(p).trigger("datepicker-change",{value:m,date1:new Date(a.start),date2:new Date(a.end)}),a.autoClose&&v())}else c.find(".apply-btn").addClass("disabled")}function k(m,b){if(m.getTime()>b.getTime()){var c=b;b=m;m=c}c=!0;a.startDate&&0>q(m,a.startDate)&&(c=!1);a.endDate&&0<q(b,a.endDate)&&(c=!1);c?(a.start=m.getTime(),
a.end=b.getTime(),0==r(m,b)&&(b=n(m)),h(m,"month1"),h(b,"month2"),w(),s()):(h(a.startDate,"month1"),h(n(a.startDate),"month2"),w())}function l(){(a.start||a.end)&&c.find(".day").each(function(){if(e(this).hasClass("toMonth")){var b=e(this).attr("time");a.start&&a.end&&a.end>=b&&a.start<=b||a.start&&!a.end&&a.start==b?e(this).addClass("checked"):e(this).removeClass("checked")}})}function h(b,e){b=moment(b).toDate();var f;f=b.getMonth();f=d("month-name")[f];c.find("."+e+" .month-name").html(f+" "+b.getFullYear());
c.find("."+e+" tbody").html(z(b));a[e]=b}function g(b){return moment(b).format(a.format)}function w(){l();var b=parseInt(moment(a.month1).format("YYYYMM")),e=parseInt(moment(a.month2).format("YYYYMM")),b=Math.abs(b-e);1<b&&89!=b?c.find(".gap").show():c.find(".gap").hide()}function v(){e(c).slideUp(200,function(){c.remove();e(p).data("date-picker-openned",!1).css("background-position","0 0")});e(document).unbind(".datepicker");e(p).trigger("datepicker-close")}var t=!1;b.stopPropagation();var p=this;
if(e(this).data("date-picker-openned"))v();else{e(this).data("date-picker-openned",!0);e(this).css("background-position","100% 100%");c=y().hide();e(document.body).append(c);b=e(this).offset();460>b.left?c.css({top:b.top+e(this).outerHeight()+parseInt(0+e("body").css("border-top"),10),left:b.left}):c.css({top:b.top+e(this).outerHeight()+parseInt(0+e("body").css("border-top"),10),left:b.left+e(p).width()-c.width()-16});b=new Date;a.startDate&&0>r(b,a.startDate)&&(b=moment(a.startDate).toDate());a.endDate&&
0<r(n(b),a.endDate)&&(b=x(moment(a.endDate).toDate()));h(b,"month1");h(n(b),"month2");c.slideDown(200);b="";b=a.minDays&&a.maxDays?d("default-range"):a.minDays?d("default-more"):a.maxDays?d("default-less"):d("default-default");c.find(".default-top").html(b.replace(/\%d/,a.minDays).replace(/\%d/,a.maxDays));if((b=a.getValue.call(p).split(a.seperator))&&2<=b.length){var u=a.format;u.match(/Do/)&&(u=u.replace(/Do/,"D"),b[0]=b[0].replace(/(\d+)(th|nd|st)/,"$1"),b[1]=b[1].replace(/(\d+)(th|nd|st)/,"$1"));
k(moment(b[0],u).toDate(),moment(b[1],u).toDate())}setTimeout(function(){t=!0},0);c.click(function(a){a.stopPropagation()});e(document).unbind(".datepicker").bind("click.datepicker",function(){v()});c.find(".next").click(function(){var b=e(this).parents("table").hasClass("month2"),c=b?a.month2:a.month1,c=n(c);!b&&0<=r(c,a.month2)||(h(c,b?"month2":"month1"),w())});c.find(".prev").click(function(){var b=e(this).parents("table").hasClass("month2"),c=b?a.month2:a.month1,c=x(c);b&&0>=r(c,a.month1)||(h(c,
b?"month2":"month1"),w())});c.bind("click",function(b){if(e(b.target).hasClass("day")&&e(b.target).hasClass("toMonth")&&(b=e(b.target),!b.hasClass("invalid"))){var c=b.attr("time");b.addClass("checked");a.start&&a.end||!a.start&&!a.end?(a.start=c,a.end=!1):a.start&&(a.end=c);a.start&&a.end&&a.start>a.end&&(b=a.end,a.end=a.start,a.start=b);a.start=parseInt(a.start);a.end=parseInt(a.end);f();s();l()}});c.attr("unselectable","on").css("user-select","none").bind("selectstart",function(a){a.preventDefault();
return!1});c.find(".apply-btn").click(function(){v();var b=g(new Date(a.start))+a.seperator+g(new Date(a.end));e(p).trigger("datepicker-apply",{value:b,date1:new Date(a.start),date2:new Date(a.end)})});c.find("[shortcut]").click(function(){var b=e(this).attr("shortcut"),c=new Date,d=!1;if(-1!=b.indexOf("day"))b=parseInt(b.split(",",2)[1],10),d=new Date((new Date).getTime()+864E5*b),c=new Date(c.getTime()+864E5*(0<b?1:-1));else if(-1!=b.indexOf("week")){b=-1!=b.indexOf("prev,")?-1:1;d=1==b?"monday"==
a.startOfWeek?1:0:"monday"==a.startOfWeek?0:6;for(c=new Date(c.getTime()-864E5);c.getDay()!=d;)c=new Date(c.getTime()+864E5*b);d=new Date(c.getTime()+5184E5*b)}else if(-1!=b.indexOf("month"))b=-1!=b.indexOf("prev,")?-1:1,d=1==b?n(c):x(c),d.setDate(1),c=n(d),c.setDate(1),c=new Date(c.getTime()-864E5);else if(-1!=b.indexOf("year"))b=-1!=b.indexOf("prev,")?-1:1,d=new Date,d.setFullYear(c.getFullYear()+b),d.setMonth(0),d.setDate(1),c.setFullYear(c.getFullYear()+b),c.setMonth(11),c.setDate(31);else if("custom"==
b){var g=e(this).html();if(a.customShortcuts&&0<a.customShortcuts.length)for(var h=0;h<a.customShortcuts.length;h++)if(b=a.customShortcuts[h],b.name==g){g=[];(g=b.dates.call())&&2==g.length&&(d=g[0],c=g[1]);break}}d&&c&&(k(d,c),f())})}});return this}})(jQuery);