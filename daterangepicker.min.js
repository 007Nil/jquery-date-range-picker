// daterangepicker.js
// version : 1.1
// author : Chunlong Liu
// license : MIT
// jszen.com

(function(d){d.dateRangePickerLanguages={cn:{selected:"\u5df2\u9009\u62e9:",days:"\u5929",apply:"\u786e\u5b9a","week-1":"\u4e00","week-2":"\u4e8c","week-3":"\u4e09","week-4":"\u56db","week-5":"\u4e94","week-6":"\u516d","week-7":"\u65e5","month-name":"\u4e00\u6708 \u4e8c\u6708 \u4e09\u6708 \u56db\u6708 \u4e94\u6708 \u516d\u6708 \u4e03\u6708 \u516b\u6708 \u4e5d\u6708 \u5341\u6708 \u5341\u4e00\u6708 \u5341\u4e8c\u6708".split(" "),shortcuts:"\u5feb\u6377\u9009\u62e9",past:"\u8fc7\u53bb","7days":"7\u5929",
"14days":"14\u5929","30days":"30\u5929",previous:"&nbsp;&nbsp;&nbsp;","prev-week":"\u4e0a\u5468","prev-month":"\u4e0a\u4e2a\u6708","prev-quarter":"\u4e0a\u4e2a\u5b63\u5ea6","prev-year":"\u53bb\u5e74","less-than":"\u6240\u9009\u65e5\u671f\u8303\u56f4\u4e0d\u80fd\u5927\u4e8e%d\u5929","more-than":"\u6240\u9009\u65e5\u671f\u8303\u56f4\u4e0d\u80fd\u5c0f\u4e8e%d\u5929","default-more":"\u8bf7\u9009\u62e9\u5927\u4e8e%d\u5929\u7684\u65e5\u671f\u8303\u56f4","default-less":"\u8bf7\u9009\u62e9\u5c0f\u4e8e%d\u5929\u7684\u65e5\u671f\u8303\u56f4",
"default-range":"\u8bf7\u9009\u62e9%d\u5929\u5230%d\u5929\u7684\u65e5\u671f\u8303\u56f4","default-default":"\u8bf7\u9009\u62e9\u4e00\u4e2a\u65e5\u671f\u8303\u56f4"},en:{selected:"Selected:",days:"Days",apply:"Close","week-1":"MO","week-2":"TU","week-3":"WE","week-4":"TH","week-5":"FR","week-6":"SA","week-7":"SU","month-name":"JANUARY FEBRUARY MARCH APRIL MAY JUNE JULY AUGUST SEPTEMBER OCTOBER NOVEMBER DECEMBER".split(" "),shortcuts:"Shortcuts",past:"Past","7days":"7days","14days":"14days","30days":"30days",
previous:"Previous","prev-week":"Week","prev-month":"Month","prev-quarter":"Quarter","prev-year":"Year","less-than":"Date range should longer than %d days","more-than":"Date range should less than %d days","default-more":"Please select a date range longer than %d days","default-less":"Please select a date range less than %d days","default-range":"Please select a date range between %d and %d days","default-default":"Please select a date range"}};void 0===window.moment?alert("Please import moment.js before daterangepicker.js"):
d.fn.dateRangePicker=function(a){function q(a,d){var b=parseInt(moment(a).format("YYYYMM"))-parseInt(moment(d).format("YYYYMM"));return 0<b?1:0==b?0:-1}function l(a,d){var b=parseInt(moment(a).format("YYYYMMDD"))-parseInt(moment(d).format("YYYYMMDD"));return 0<b?1:0==b?0:-1}function r(a){a=moment(a).toDate();for(var b=a.getMonth();a.getMonth()==b;)a=new Date(a.getTime()+864E5);return a}function m(a){a=moment(a).toDate();for(var b=a.getMonth();a.getMonth()==b;)a=new Date(a.getTime()-864E5);return a}
function w(){return"monday"==a.startOfWeek?"<th>"+c("week-1")+"</th><th>"+c("week-2")+"</th><th>"+c("week-3")+"</th><th>"+c("week-4")+"</th><th>"+c("week-5")+"</th><th>"+c("week-6")+"</th><th>"+c("week-7")+"</th>":"<th>"+c("week-7")+"</th><th>"+c("week-1")+"</th><th>"+c("week-2")+"</th><th>"+c("week-3")+"</th><th>"+c("week-4")+"</th><th>"+c("week-5")+"</th><th>"+c("week-6")+"</th>"}function z(e){var b=[];e.setDate(1);e.getTime();if(0<e.getDay())for(var d=e.getDay();0<d;d--){var c=new Date(e.getTime()-
864E5*d),h=!0;a.startDate&&0>l(c,a.startDate)&&(h=!1);a.endDate&&0<l(c,a.endDate)&&(h=!1);b.push({type:"lastMonth",day:c.getDate(),time:c.getTime(),valid:h})}c=e.getMonth();for(d=0;40>d;d++){var f=new Date(e.getTime()+864E5*d),h=!0;a.startDate&&0>l(f,a.startDate)&&(h=!1);a.endDate&&0<l(f,a.endDate)&&(h=!1);b.push({type:f.getMonth()==c?"toMonth":"nextMonth",day:f.getDate(),time:f.getTime(),valid:h})}e=[];for(d=0;6>d&&"nextMonth"!=b[7*d].type;d++){e.push("<tr>");for(c=0;7>c;c++)f=b[7*d+("monday"==a.startOfWeek?
c+1:c)],e.push('<td><div time="'+f.time+'" class="day '+f.type+" "+(f.valid?"valid":"invalid")+'">'+f.day+"</div></td>");e.push("</tr>")}return e.join("")}function c(a){return a in s?s[a]:a}a||(a={});a=d.extend({format:"YYYY-MM-DD",seperator:" to ",language:"auto",startOfWeek:"sunday",getValue:function(){return this.value},setValue:function(a){this.value=a},startDate:!1,endDate:!1,minDays:0,maxDays:0},a);a.start=!1;a.end=!1;a.startDate&&"string"==typeof a.startDate&&(a.startDate=moment(a.startDate,
a.format).toDate());a.endDate&&"string"==typeof a.endDate&&(a.endDate=moment(a.endDate,a.format).toDate());var s=function(){if("auto"==a.language){var b=navigator.language?navigator.language:navigator.browserLanguage;if(!b)return d.dateRangePickerLanguages.en;var b=b.toLowerCase(),c;for(c in d.dateRangePickerLanguages)if(-1!=b.indexOf(c))return d.dateRangePickerLanguages[c];return d.dateRangePickerLanguages.en}return a.language&&a.language in d.dateRangePickerLanguages?d.dateRangePickerLanguages[a.language]:
d.dateRangePickerLanguages.en}(),b;d(this).unbind(".datepicker").bind("click.datepicker",function(e){function s(){var g=Math.ceil((a.end-a.start)/864E5)+1;a.maxDays&&g>a.maxDays?(a.start=!1,a.end=!1,b.find(".day").removeClass("checked"),b.find(".top-bar").removeClass("normal").addClass("error").find(".error-top").html(c("less-than").replace("%d",a.maxDays))):a.minDays&&g<a.minDays?(a.start=!1,a.end=!1,b.find(".day").removeClass("checked"),b.find(".top-bar").removeClass("normal").addClass("error").find(".error-top").html(c("more-than").replace("%d",
a.minDays))):a.start||a.end?b.find(".top-bar").removeClass("error").addClass("normal"):b.find(".top-bar").removeClass("error").removeClass("normal");a.start&&a.end?b.find(".apply-btn").removeClass("disabled"):b.find(".apply-btn").addClass("disabled")}function v(){b.find(".start-day").html("...");b.find(".end-day").html("...");b.find(".selected-days").hide();a.start&&b.find(".start-day").html(n(new Date(parseInt(a.start))));a.end&&b.find(".end-day").html(n(new Date(parseInt(a.end))));if(a.start&&a.end){b.find(".selected-days").show().find(".selected-days-num").html(Math.round((a.end-
a.start)/864E5)+1);b.find(".apply-btn").removeClass("disabled");var g=n(new Date(a.start))+a.seperator+n(new Date(a.end));a.setValue.call(j,g);d(j).trigger("datepicker-change",{value:g,date1:new Date(a.start),date2:new Date(a.end)})}else b.find(".apply-btn").addClass("disabled")}function x(g,b){var d=!0;a.startDate&&0>l(g,a.startDate)&&(d=!1);a.endDate&&0<l(b,a.endDate)&&(d=!1);d?(a.start=g.getTime(),a.end=b.getTime(),0==q(g,b)&&(b=r(g)),f(g,"month1"),f(b,"month2"),t(),v()):(f(a.startDate,"month1"),
f(r(a.startDate),"month2"),t())}function h(){(a.start||a.end)&&b.find(".day").each(function(){if(d(this).hasClass("toMonth")){var b=d(this).attr("time");a.start&&a.end&&a.end>=b&&a.start<=b||a.start&&!a.end&&a.start==b?d(this).addClass("checked"):d(this).removeClass("checked")}})}function f(d,e){d=moment(d).toDate();var f;f=d.getMonth();f=c("month-name")[f];b.find("."+e+" .month-name").html(f+" "+d.getFullYear());b.find("."+e+" tbody").html(z(d));a[e]=d}function n(b){return moment(b).format(a.format)}
function t(){h();var d=parseInt(moment(a.month1).format("YYYYMM")),c=parseInt(moment(a.month2).format("YYYYMM")),d=Math.abs(d-c);1<d&&89!=d?b.find(".gap").show():b.find(".gap").hide()}function u(){d(b).slideUp(200,function(){b.remove();d(j).data("date-picker-openned",!1).css("background-position","0 0")});d(document).unbind(".datepicker");d(j).trigger("datepicker-close")}e.stopPropagation();var j=this;if(d(this).data("date-picker-openned"))u();else{d(this).data("date-picker-openned",!0);d(this).css("background-position",
"100% 100%");e=d;var k='<div class="date-picker-wrapper"><div class="top-bar"><div class="normal-top"><span style="color:#333">'+c("selected")+' </span> <b class="start-day">...</b> '+a.seperator+' <b class="end-day">...</b> <i class="selected-days">(<span class="selected-days-num">3</span> '+c("days")+')</i></div><div class="error-top">error</div><div class="default-top">default</div><input type="button" class="apply-btn disabled" value="'+c("apply")+'" /></div><div class="month-wrapper"><table class="month1" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th style="width:27px;"><span class="prev">&lt;</span></th><th colspan="5" class="month-name">January, 2011</th><th style="width:27px;"><span class="next">&gt;</span></th></tr><tr class="week-name">'+
w()+'</thead><tbody></tbody></table><div class="gap">',p;p=['<div class="gap-top-mask"></div><div class="gap-bottom-mask"></div><div class="gap-lines">'];for(var y=0;13>y;y++)p.push('<div class="gap-line"><div class="gap-1"></div><div class="gap-2"></div><div class="gap-3"></div></div>');p.push("</div>");p=p.join("");b=e(k+p+'</div><table class="month2" cellspacing="0" border="0" cellpadding="0"><thead><tr class="caption"><th style="width:27px;"><span class="prev">&lt;</span></th><th colspan="5" class="month-name">January, 2011</th><th style="width:27px;"><span class="next">&gt;</span></th></tr><tr class="week-name">'+
w()+'</thead><tbody></tbody></table><div style="clear:both;height:0;font-size:0;"></div></div><div class="footer"><b>'+c("shortcuts")+"</b> &nbsp; "+c("past")+' <a href="javascript:;" shortcut="day,7">'+c("7days")+'</a> <a href="javascript:;" shortcut="day,14">'+c("14days")+'</a> <a href="javascript:;" shortcut="day,30">'+c("30days")+"</a>&nbsp;&nbsp; "+c("previous")+' <a href="javascript:;" shortcut="week">'+c("prev-week")+'</a> <a href="javascript:;" shortcut="month">'+c("prev-month")+'</a> <a href="javascript:;" shortcut="quarted">'+
c("prev-quarter")+'</a> <a href="javascript:;" shortcut="year">'+c("prev-year")+"</a></div></div>").hide();d(document.body).append(b);e=d(this).offset();460>e.left?b.css({top:e.top+d(this).outerHeight()+parseInt(d("body").css("border-top")),left:e.left}):b.css({top:e.top+d(this).outerHeight()+parseInt(d("body").css("border-top")),left:e.left+d(j).width()-b.width()-16});e=new Date;a.startDate&&0>q(e,a.startDate)&&(e=moment(a.startDate).toDate());a.endDate&&0<q(r(e),a.endDate)&&(e=m(moment(a.endDate).toDate()));
f(e,"month1");f(r(e),"month2");b.slideDown(200);e="";e=a.minDays&&a.maxDays?c("default-range"):a.minDays?c("default-more"):a.maxDays?c("default-less"):c("default-default");b.find(".default-top").html(e.replace(/\%d/,a.minDays).replace(/\%d/,a.maxDays));if((e=a.getValue.call(j).split(a.seperator))&&2<=e.length)k=a.format,k.match(/Do/)&&(k=k.replace(/Do/,"D"),e[0]=e[0].replace(/(\d+)(th|nd|st)/,"$1"),e[1]=e[1].replace(/(\d+)(th|nd|st)/,"$1")),x(moment(e[0],k).toDate(),moment(e[1],k).toDate());b.click(function(a){a.stopPropagation()});
d(document).unbind(".datepicker").bind("click.datepicker",function(){u()});b.find(".next").click(function(){var b=d(this).parents("table").hasClass("month2"),c=b?a.month2:a.month1,c=r(c);if(b||!(0<=q(c,a.month2)))f(c,b?"month2":"month1"),t()});b.find(".prev").click(function(){var b=d(this).parents("table").hasClass("month2"),c=b?a.month2:a.month1,c=m(c);b&&0>=q(c,a.month1)||(f(c,b?"month2":"month1"),t())});b.bind("click",function(b){if(d(b.target).hasClass("day")&&d(b.target).hasClass("toMonth")&&
(b=d(b.target),!b.hasClass("invalid"))){var c=b.attr("time");b.addClass("checked");a.start&&a.end||!a.start&&!a.end?(a.start=c,a.end=!1):a.start&&(a.end=c);a.start&&(a.end&&a.start>a.end)&&(b=a.end,a.end=a.start,a.start=b);a.start=parseInt(a.start);a.end=parseInt(a.end);s();v();h()}});b.attr("unselectable","on").css("user-select","none").bind("selectstart",function(a){a.preventDefault();return!1});b.find(".apply-btn").click(function(){a.start&&a.end&&a.setValue.call(j,n(new Date(a.start))+a.seperator+
n(new Date(a.end)));u()});b.find("[shortcut]").click(function(){var b=d(this).attr("shortcut"),c=new Date,e;if(-1!=b.indexOf("day"))b=parseInt(b.split(",",2)[1]),e=new Date((new Date).getTime()-864E5*(b-1));else if("week"==b){for(b="monday"==a.startOfWeek?0:6;c.getDay()!=b;)c=new Date(c.getTime()-864E5);e=new Date(c.getTime()-5184E5)}else"month"==b?(e=m(c),e.setDate(1),c.setDate(1),c=new Date(c.getTime()-864E5)):"quarted"==b?(e=m(m(m(c))),e.setDate(1),c.setDate(1),c=new Date(c.getTime()-864E5)):"year"==
b&&(e=new Date,e.setFullYear(c.getFullYear()-1),e.setMonth(0),e.setDate(1),c.setFullYear(c.getFullYear()-1),c.setMonth(11),c.setDate(31));x(e,c);s()})}});return this}})(jQuery);